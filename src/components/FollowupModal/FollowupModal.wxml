
<!-- 随访记录模态框组件 -->
<view class="modal">
  <view class="modal-content">
    <view class="modal-header">
      <view class="modal-title-with-icon">
        <image src="/images/calendar.png" class="modal-title-icon" />
        <text>{{modalTitle}}</text>
      </view>
      <text class="modal-subtitle">{{modalSubtitle}}</text>
      <button class="close-btn" bindtap="onClose">
        <image src="/images/close.png" class="close-icon" />
      </button>
    </view>

    <view class="modal-body">
      <view class="form-group">
        <label class="form-label">本次随访日期</label>
        <view class="picker-container {{isEditing ? 'disabled-picker' : ''}}">
          <picker 
            mode="date" 
            value="{{localFollowupData.followupDate}}" 
            disabled="{{disabled || isEditing}}"
            bindchange="onDateChange"
            data-field="followupDate"
            start="{{minDate}}"
            class="date-picker"
          >
            <view class="picker-display">
              <text class="picker-text {{localFollowupData.followupDate ? '' : 'placeholder'}}">
                {{localFollowupData.followupDate ? localFollowupData.followupDate : '请选择本次随访日期'}}
              </text>
              <image src="/images/calendar-select.png" class="picker-icon" />
            </view>
          </picker>
        </view>
      </view>

      <view class="form-group">
        <label class="form-label">下次随访日期</label>
        <view class="picker-container">
          <picker 
            mode="date" 
            value="{{localFollowupData.nextFollowupDate}}" 
            disabled="{{disabled}}"
            bindchange="onDateChange"
            data-field="nextFollowupDate"
            start="{{localFollowupData.followupDate || minDate}}"
            class="date-picker"
          >
            <view class="picker-display">
              <text class="picker-text {{localFollowupData.nextFollowupDate ? '' : 'placeholder'}}">
                {{localFollowupData.nextFollowupDate ? localFollowupData.nextFollowupDate : '请选择下次随访日期'}}
              </text>
              <image src="/images/calendar-select.png" class="picker-icon" />
            </view>
          </picker>
        </view>
        <view wx:if="{{dateError}}" class="error-message">
          <text>下次随访日期不能早于本次随访日期</text>
        </view>
      </view>

      <view class="form-group">
        <label class="form-label">随访内容</label>
        <!-- 修复文本区域绑定问题 -->
        <textarea 
          value="{{localFollowupData.content}}" 
          placeholder="请输入本次随访的具体内容和建议..." 
          disabled="{{disabled}}"
          bindinput="onInput"
          data-field="content"
          class="form-textarea"
          rows="3"
          style="height: 200rpx;"
        />
      </view>
    </view>

    <view class="modal-footer">
      <button class="btn-cancel" bindtap="onCancel" disabled="{{disabled}}">取消</button>
      <button class="btn-confirm" bindtap="onConfirm" disabled="{{disabled || dateError}}">
        <image wx:if="{{disabled}}" src="/images/loading.gif" class="btn-loading" />
        <text>{{confirmText}}</text>
      </button>
    </view>
  </view>
</view>
